# Gemini 助手 - 变更日志

## 版本 1.7.2 (2025-12-14)

> **智能升级**：本版本彻底重构了“锚点恢复”逻辑，引入了基于内容的精准定位与自动历史回溯，确保在任何场景下都能精准恢复阅读进度。

### ✨ 智能锚点系统 (Smart Anchor System)

- **精准内容定位 (Content-Based Anchoring)**：
  - 弃用了不稳定的纯像素定位，改用“唯一元素+偏移量”的算法。
  - 即使在懒加载或内容变化的情况下，也能精准定位到具体的对话气泡。
- **自动历史回溯 (Auto History Backtracking)**：
  - 当目标内容未加载时（如长对话的历史消息），脚本会自动向上滚动触发加载。
  - 支持多轮自动重试与回溯，直到找到目标锚点，彻底解决了“刷新后无法恢复高楼层进度”的痛点。
- **智能恢复策略**：
  - 初始化时自动尝试恢复。
  - SPA 路由变化时自动尝试恢复。
  - 页面刷新后自动尝试恢复。

### 🎨 体验优化

- **大纲配置升级**：
  - 标题优化为更简洁的“大纲设置”。
  - 新增 **1 天** 和 **3 天** 的自动清理选项（默认调整为 7 天）。
- **稳健性提升**：
  - 修复了脚本初始化时可能出现的构造函数报错。
  - 优化了滚动容器的获取逻辑，兼容各类动态加载场景。

---

## 版本 1.7.1 (2025-12-13)

> **体验优化**：本版本重点打磨了设置面板的交互体验，并增强了对模型自动化的支持。

### ✨ 支持全站点模型自动化锁定

- **覆盖全平台**：现在支持 Gemini 标准版、Gemini 企业版 (Business/Enterprise)、AI Studio 以及 Vertex AI 的模型自动锁定。
- **独立配置**：每个站点可独立配置是否开启锁定以及锁定的关键词（如 `3 Pro`）。
- **自动化执行**：进入页面时自动检测并切换到指定模型，减少重复操作。

### 🎨 设面板 UI 重构

- **可折叠收纳**：将“模型锁定”、“页面宽度”、“界面排版”重构为可折叠面板，界面更整洁。
- **逻辑重排**：优化了设置项的排列顺序，将常用设置置顶。
- **平滑动画**：为折叠/展开操作添加了优雅的动画效果。

---

## 版本 1.7.0 (2025-12-12)

> **里程碑更新**：本版本带来了全新的对话大纲功能、面板 UI 的全面优化以及更智能的页面适配。

### ✨ 核心功能：对话大纲系统

- **结构化大纲生成**：自动从 AI 回复中提取 H1-H6 标题结构，生成清晰的目录树。
- **智能缩进与折叠**：
  - 根据提取到的最高标题层级自动调整缩进，避免空白。
  - 支持一键展开/折叠全部节点。
  - 支持层级滑块（Slider），快速过滤显示至特定级别的标题。
- **快速跳转导航**：点击大纲项平滑滚动至对话位置，并伴有高亮闪烁提示，长对话浏览更轻松。
- **Tab 独立管理**：
  - 新增"📑 大纲"标签页，与提示词、设置页签并列。
  - 提供开关控制，不需要时可完全关闭大纲功能。

### 🎨 UI 与交互体验优化

- **面板高度智能化**：
  - 摒弃了固定的像素限制，面板高度现在智能适配屏幕（占用约 80% 视口高度）。
  - 内部滚动区域自适应，在大屏上可展示更多内容，小屏下自动回缩。
- **界面排版自定义**：
  - 新增 **Tab 排序功能**，用户可在设置中自由拖拽调整"提示词"、"大纲"、"设置"的显示顺序。
- **视觉细节打磨**：
  - 优化了面板的阴影、边框和圆角处理，使其更符合 Material Design 风格。
  - 统一了各模块的按钮样式和交互反馈。

### 🔧 页面适配与兼容性

- **Gemini Business 专属增强**：
  - 针对企业版（Shadow DOM）架构进行了深度适配，确保所有功能（包括大纲提取）完美运行。
  - 新增 **中文输入修复**：发送消息后自动插入零宽字符，解决企业版特有的中文输入首字母变英文的问题。
- **页面加宽重构**：
  - 重写了页面加宽逻辑，支持百分比（%）和像素（px）两种单位。
  - 修复了加宽模式下用户消息对齐问题，确保界面布局协调。
- **多站点支持**：底层架构升级为适配器模式，完美兼容 Gemini 标准版、Gemini 企业版及 Genspark。

### ⚙️ 其他改进

- **多语言系统**：完整支持简体中文、繁体中文和英语，根据浏览器语言自动切换。
- **配置持久化**：所有设置（开关、排序、宽度）均本地保存，刷新不丢失。

---

## 版本 1.6.0 (2025-12-10)

- ✨ **新功能**：Tab 切换架构（提示词 | 设置）
- ✨ **新功能**：设置面板（仅 Gemini Business）
  - 发送后自动修复中文输入开关
- 🌐 **国际化**：多语言支持（简中/繁中/英语）
- 🎨 **UI**：面板重命名为"Gemini 助手"

---

## 版本 1.5.0 (2025-12-09)

- ⚡️ **重构**：引入站点适配器模式 (Site Adapter Pattern)，大幅提升代码扩展性
- 🛠 **优化**：解耦特定站点逻辑，为未来支持更多 AI 平台奠定基础
- 修复页面加载后首次插入提示词时，多行文本只能插入首行

---

## 版本 1.4.0 (2025-12-08)

- 新增分类管理功能（重命名、删除）
- 新增拖动排序功能
- 新增复制提示词功能

---

## 版本 1.3.0 (2025-12-08)

- 优化悬浮条逻辑，发送后自动隐藏

---

## 版本 1.2.0 (2025-12-08)

- 新增快捷跳转按钮（顶部/底部）

---

## 版本 1.1.0 (2025-12-08)

- 支持 Gemini 企业版 (Shadow DOM 适配)
