# Gemini Helper ç–‘éš¾æ‚ç—‡æŽ’æŸ¥æ‰‹å†Œ

> è®°å½•å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„ç¨€å¥‡å¤æ€ªé—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆï¼Œä¾›åŽç»­å‚è€ƒã€‚

---

## ðŸ“‹ ç›®å½•

1. [æ»šåŠ¨å®¹å™¨é”™è¯¯åŒ¹é…](#1-æ»šåŠ¨å®¹å™¨é”™è¯¯åŒ¹é…)
2. [é˜…è¯»åŽ†å²ä¼šè¯åˆ‡æ¢åŽä¸æ›´æ–°](#2-é˜…è¯»åŽ†å²ä¼šè¯åˆ‡æ¢åŽä¸æ›´æ–°)

---

## 1. æ»šåŠ¨å®¹å™¨é”™è¯¯åŒ¹é…

**æ—¥æœŸ**: 2025-12-18

### ç—‡çŠ¶

- "åŽ»é¡¶éƒ¨"/"åŽ»åº•éƒ¨"æŒ‰é’®ç‚¹å‡»åŽï¼Œ**ä¾§è¾¹æ ä¼šè¯åˆ—è¡¨**æ»šåŠ¨äº†ï¼Œè€Œéžä¸»å¯¹è¯åŒºåŸŸ
- é”šç‚¹è·³è½¬å¤±æ•ˆ
- å¤§çº²ç‚¹å‡»è·³è½¬åˆ°é”™è¯¯ä½ç½®

### èƒŒæ™¯

åœ¨å¼€å‘"ä¼šè¯"Tab åŠŸèƒ½æ—¶æ–°å¢žäº†ä»¥ä¸‹ä»£ç ï¼š

- `SiteAdapter.getSidebarScrollContainer()` - è¿”å›žä¾§è¾¹æ çš„ `infinite-scroller`
- `SiteAdapter.loadAllConversations()` - æ»šåŠ¨ä¾§è¾¹æ åŠ è½½å…¨éƒ¨ä¼šè¯

### æ ¹å› 

Gemini é¡µé¢ä¸­å­˜åœ¨ **ä¸¤ä¸ª `infinite-scroller` å…ƒç´ **ï¼š

1. **ä¸»å¯¹è¯åŒºåŸŸ**: `infinite-scroller.chat-history`
2. **ä¾§è¾¹æ ä¼šè¯åˆ—è¡¨**: `infinite-scroller[scrollable="true"]`

`DOMToolkit.findScrollContainer()` åœ¨æŸ¥æ‰¾æ—¶ï¼Œå¦‚æžœç”¨æˆ·æä¾›çš„é€‰æ‹©å™¨éƒ½æœªåŒ¹é…ï¼Œä¼š**éåŽ† DOM æŸ¥æ‰¾ç¬¬ä¸€ä¸ªæ»¡è¶³æ»šåŠ¨æ¡ä»¶çš„å…ƒç´ **ï¼ˆ`scrollHeight > clientHeight` ä¸” `overflow: auto/scroll`ï¼‰ã€‚

ç”±äºŽä¾§è¾¹æ çš„ `infinite-scroller` ä¹Ÿæ»¡è¶³æ»šåŠ¨æ¡ä»¶ï¼Œåœ¨ç‰¹å®šæƒ…å†µä¸‹å¯èƒ½è¢«ä¼˜å…ˆåŒ¹é…ã€‚

### ä¿®å¤æ–¹æ¡ˆ

åœ¨ `SiteAdapter.getScrollContainer()` çš„é€‰æ‹©å™¨æ•°ç»„**é¦–ä½**æ·»åŠ ç²¾ç¡®é€‰æ‹©å™¨ï¼š

```javascript
getScrollContainer() {
    return DOMToolkit.findScrollContainer({
        selectors: [
            'infinite-scroller.chat-history', // ç²¾ç¡®åŒ¹é…ä¸»å¯¹è¯åŒºåŸŸ
            '.chat-mode-scroller',
            'main',
            '[role="main"]',
            '.conversation-container',
            '.chat-container',
        ],
    });
}
```

### ç»éªŒæ€»ç»“

| æ•™è®­                       | è¯´æ˜Ž                                                                                              |
| -------------------------- | ------------------------------------------------------------------------------------------------- |
| **é€‰æ‹©å™¨è¦ç²¾ç¡®**           | å½“é¡µé¢å­˜åœ¨å¤šä¸ªç›¸ä¼¼å…ƒç´ æ—¶ï¼Œé€šç”¨é€‰æ‹©å™¨ï¼ˆå¦‚æ ‡ç­¾åï¼‰å¯èƒ½åŒ¹é…åˆ°é”™è¯¯å…ƒç´                                 |
| **æ–°å¢žåŠŸèƒ½å¯èƒ½å½±å“æ—§åŠŸèƒ½** | æ–°å¢žä¾§è¾¹æ æ“ä½œè™½ç„¶æ²¡æœ‰ç›´æŽ¥ä¿®æ”¹æ»šåŠ¨é€»è¾‘ï¼Œä½†æ”¹å˜äº† DOM ç»“æž„æˆ–æŸ¥æ‰¾é¡ºåº                               |
| **å¯¹æ¯”æ³•æŽ’æŸ¥**             | ä½¿ç”¨ Git æ‰¾å›žæ­£å¸¸ç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”ï¼Œå¿«é€Ÿå®šä½å·®å¼‚èŒƒå›´                                                   |
| **å¤ç”¨çŽ°æœ‰é€‰æ‹©å™¨**         | `getResponseContainerSelector()` è¿”å›žçš„ `infinite-scroller.chat-history` æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„ç²¾ç¡®é€‰æ‹©å™¨ |

---

## 2. é˜…è¯»åŽ†å²ä¼šè¯åˆ‡æ¢åŽä¸æ›´æ–°

**æ—¥æœŸ**: 2025-12-23

### ç—‡çŠ¶

- åœ¨ä¼šè¯ A ä¸­æ»šåŠ¨åŽï¼Œåˆ‡æ¢åˆ°ä¼šè¯ Bï¼Œå†å›žåˆ° Aï¼Œå‘çŽ°é˜…è¯»ä½ç½®æ²¡æœ‰æ›´æ–°
- åªæœ‰ç¬¬ä¸€ä¸ªæ‰“å¼€çš„ä¼šè¯çš„é˜…è¯»ä½ç½®ä¼šè¢«è®°å½•

### èƒŒæ™¯

`ReadingProgressManager` é€šè¿‡ç›‘å¬æ»šåŠ¨å®¹å™¨çš„ `scroll` äº‹ä»¶æ¥è®°å½•ä½ç½®ã€‚

### æ ¹å› 

Gemini æ˜¯ SPA åº”ç”¨ï¼Œä¼šè¯åˆ‡æ¢æ—¶ DOM ä¼šé‡æ–°æ¸²æŸ“ï¼Œ**æ—§çš„æ»šåŠ¨å®¹å™¨å…ƒç´ ä¼šè¢«é”€æ¯**ã€‚

é—®é¢˜ä»£ç ï¼š

```javascript
startRecording() {
    if (this.isRecording) return;  // âš ï¸ å·²åœ¨è®°å½•ï¼Œç›´æŽ¥è¿”å›ž
    // ... ç»‘å®šç›‘å¬åˆ°å½“å‰å®¹å™¨
}
```

ä¼šè¯åˆ‡æ¢åŽï¼š

1. `restoreReadingProgress` è°ƒç”¨ `startRecording()`
2. ä½† `isRecording = true`ï¼ˆé¦–æ¬¡è¿›å…¥æ—¶å·²è®¾ç½®ï¼‰ï¼Œç›´æŽ¥è¿”å›ž
3. ç»“æžœï¼šç›‘å¬ä»ç»‘å®šåœ¨å·²é”€æ¯çš„æ—§å®¹å™¨ä¸Šï¼Œæ–°å®¹å™¨æ²¡æœ‰ç›‘å¬

### ä¿®å¤æ–¹æ¡ˆ

æ–°å¢ž `restartRecording()` æ–¹æ³•ï¼Œä¼šè¯åˆ‡æ¢æ—¶å¼ºåˆ¶é‡æ–°ç»‘å®šï¼š

```javascript
restartRecording() {
    this.stopRecording();  // å…ˆç§»é™¤æ—§ç›‘å¬
    this.startRecording(); // å†ç»‘å®šæ–°å®¹å™¨
}
```

è°ƒç”¨ç‚¹ä¿®æ”¹ï¼š

```javascript
// restoreReadingProgress ä¸­
this.readingProgressManager.restartRecording();  // åŽŸä¸º startRecording()
```

### ç»éªŒæ€»ç»“

| æ•™è®­                     | è¯´æ˜Ž                                                                       |
| ------------------------ | -------------------------------------------------------------------------- |
| **SPA å®¹å™¨ä¼šå˜**         | å•é¡µåº”ç”¨ä¸­ DOM å…ƒç´ å¯èƒ½éšæ—¶è¢«æ›¿æ¢ï¼Œäº‹ä»¶ç›‘å¬éœ€è¦é‡æ–°ç»‘å®š                    |
| **çŠ¶æ€æ ‡å¿—éœ€é…å¥—**       | `isRecording` é˜²é‡å…¥æ˜¯å¥½çš„ï¼Œä½†éœ€è¦é…å¥—æä¾› `restart` æ–¹æ³•å¤„ç†å®¹å™¨æ›´æ¢åœºæ™¯  |
| **getter vs å¼•ç”¨**       | `scrollManager.container` æ˜¯ getterï¼Œæ¯æ¬¡è°ƒç”¨é‡æ–°æŸ¥è¯¢ DOMï¼Œä¸æ˜¯å›ºå®šå¼•ç”¨   |

---

## N. é—®é¢˜æ ‡é¢˜

**æ—¥æœŸ**: YYYY-MM-DD

### ç—‡çŠ¶

- æè¿°ç”¨æˆ·å¯è§‚å¯Ÿåˆ°çš„å¼‚å¸¸è¡Œä¸º

### èƒŒæ™¯

- é—®é¢˜å‡ºçŽ°çš„ä¸Šä¸‹æ–‡

### æ ¹å› 

- æŠ€æœ¯å±‚é¢çš„åŽŸå› åˆ†æž

### ä¿®å¤æ–¹æ¡ˆ

```javascript
// å…³é”®ä»£ç ç‰‡æ®µ
```

### ç»éªŒæ€»ç»“

| æ•™è®­ | è¯´æ˜Ž |
| ---- | ---- |
| ...  | ...  |

-->
